{"version":3,"sources":["scripts.js","share.js"],"names":["PageTimer","self","this","getLoadTime","now","Date","getTime","window","performance","mozPerformance","msPerformance","webkitPerformance","timing","ms","navigationStart","Math","round","logToConsole","$","on","console","info","append","holder","text","StickyFooter","$wrap","$footer","$window","updateWrapperCSS","footerHeight","outerHeight","css","marginBottom","paddingBottom","bindOnResize","update","ExternalLinkHandler","hostname","document","location","matchInternalLink","RegExp","addTargetAttribute","context","find","filter","each","anchor","href","attr","isInternalLink","i","length","regex","match","addClass","UIBindings","bindTooltips","tooltip","bindPopovers","popover","bindSlickCarousels","slick","dots","slidesToShow","slidesToScroll","arrows","fade","e","preventDefault","index","data","bindSharing","shareHandler","ShareHandler","appendFacebook","appendTwitter","appendGoogle","bindMagnificpopup","magnificPopup","type","callbacks","markupParse","template","values","item","description","el","gallery","enabled","image","headerFit","captionFit","preserveHeaderAndCaptionWidth","markup","bindMasonary","load","masonry","itemSelector","columnWidth","gutter","bindSubmittingButtons","submitText","submittingText","btn","closest","removeClass","hide","prop","Notifications","wrapper","div","wrapperTop","offset","top","bindOnScroll","height","scrollTop","bindCloseButton","notification","fadeOut","init","$container","definedProps","url","buildHttpQuery","copy","k","v","param","openPopup","shareWindow","conf","screen","left","width","focus","resizeTo","moveTo","popups","google-plus","opt","hl","lang","facebook","u","t","twitter","via","linkedin","isFramed","pinterest","media","createButton","platform","button","cursor","share","sharePage","$page","shareProps","extend","startLen","diff","substr","popupConf","open","shareLoader","spinner","position","ajax","async","success","remove","error","alert","appendLinkedIn","appendPinterest","App"],"mappings":"AAEA,YAEA,SAAAA,aACA,GAAAC,GAAAC,IACAA,MAAAC,YAAA,WACA,GAAAC,IAAA,GAAAC,OAAAC,SAEAC,QAAAC,YAAAD,OAAAC,aAAAD,OAAAE,gBAAAF,OAAAG,eAAAH,OAAAI,qBACA,IAAAC,GAAAJ,YAAAI,WAEAC,EAAAT,EAAAQ,EAAAE,eAEA,OAAAC,MAAAC,MAAAH,EAAA,IAAA,KAGAX,KAAAe,aAAA,WACAC,EAAAX,QAAAY,GAAA,OAAA,WACAC,SAAAA,QAAAC,MAAAD,QAAAC,KAAA,oBAAApB,EAAAE,cAAA,QAIAD,KAAAoB,OAAA,SAAAC,GACAL,EAAAX,QAAAY,GAAA,OAAA,WACAI,EAAAC,KAAA,UAAAvB,EAAAE,cAAA,QAMA,QAAAsB,cAAAC,EAAAC,GACA,GAAAC,GAAAV,EAAAX,OACAL,MAAA2B,iBAAA,WACA,GAAAC,GAAAH,EAAAI,aAEAL,GAAAM,KACAC,gBAAAH,EACAI,cAAAJ,KAIA5B,KAAAiC,aAAA,WAGA,MAFAP,GAAAT,GAAA,SAAAjB,KAAA2B,kBAEA3B,MAGAA,KAAAkC,OAAA,WAGA,MAFAlC,MAAA2B,mBAEA3B,MAWA,QAAAmC,uBACA,GAAApC,GAAAC,KACAoC,EAAAC,SAAAC,SAAAF,QAEApC,MAAAuC,mBAAA,GAAAC,QAAA,kBAAAJ,IAEApC,KAAAyC,mBAAA,SAAAC,GACAA,EAAAC,KAAA,KAAAC,OAAA,yCAAAC,KAAA,WAKA,IAAA,GAJAC,GAAA9B,EAAAhB,MACA+C,EAAAD,EAAAE,KAAA,QACAC,GAAA,EAEAC,EAAA,EAAAA,EAAAnD,EAAAwC,kBAAAY,OAAAD,IAAA,CACA,GAAAE,GAAArD,EAAAwC,kBAAAW,EACAH,GAAAM,MAAAD,KACAH,GAAA,GAIAA,GACAH,EAAAE,KAAA,SAAA,UAAAM,SAAA,oBAOA,QAAAC,cACAvD,KAAAwD,aAAA,WACAxC,EAAA,2BAAAyC,WAEAzD,KAAA0D,aAAA,WACA1C,EAAA,2BAAA2C,WAGA3D,KAAA4D,mBAAA,WACA5C,EAAA,iCAAA6C,OACAC,MAAA,EACAC,aAAA,EACAC,eAAA,EACAC,QAAA,EACAC,MAAA,IAGAlD,EAAA,6BAAAC,GAAA,QAAA,SAAAkD,GACAA,EAAAC,gBACA,IAAAC,GAAArD,EAAAhB,MAAAsE,KAAA,QACAtD,GAAA,iCAAA6C,MAAA,YAAAQ,MAIArE,KAAAuE,YAAA,WACAvD,EAAA,wBAAA6B,KAAA,WACA,GAAA2B,GAAA,GAAAC,cAAAzD,EAAAhB,MACAwE,GAAAE,iBACAF,EAAAG,gBACAH,EAAAI,kBAMA5E,KAAA6E,kBAAA,WACA7D,EAAA,kBAAA8D,eACAC,KAAA,QACAC,WAEAC,YAAA,SAAAC,EAAAC,EAAAC,GAEAD,EAAAE,YAAAD,EAAAE,GAAAhB,KAAA,iBAGAiB,SACAC,SAAA,GAGAC,OAEAC,WAAA,EACAC,YAAA,EACAC,+BAAA,EACAC,OACA,uiBA6BA7F,KAAA8F,aAAA,WACA9E,EAAA,OAAA+E,KAAA,WACA/E,EAAA,SAAAgF,YAEAhF,EAAA,SAAAgF,SACAC,aAAA,aACAC,YAAA,cACAC,OAAA,KAIAnG,KAAAoG,sBAAA,WACApF,EAAAqB,UAAApB,GAAA,SAAA,WACA,GAAAoF,GAAArF,EAAAhB,MAAA2C,KAAA,sBACA2D,EAAAtF,EAAAhB,MAAA2C,KAAA,0BACA4D,EAAAF,EAAAG,QAAA,SACAF,GAAAG,YAAA,QACAJ,EAAAK,OACAH,EAAAI,KAAA,YAAA,MAOA,QAAAC,iBACA,GAAAC,GAAA7F,EAAA,0BACA8F,EAAA9F,EAAA,kBACA+F,EAAAF,EAAAG,SAAAC,GAEAjH,MAAAkH,aAAA,WACAL,EAAAM,OAAAN,EAAAM,UACAnG,EAAAX,QAAAY,GAAA,SAAA,WACA,GAAAmG,GAAApG,EAAAX,QAAA+G,WACAA,GAAAL,EACAD,EAAAxD,SAAA,SAEAwD,EAAAL,YAAA,YAKAzG,KAAAqH,gBAAA,WACArG,EAAAqB,UAAApB,GAAA,QAAA,yBAAA,SAAAkD,GACAA,EAAAC,gBACA,IAAAkD,GAAAtG,EAAAhB,MAAAwG,QAAA,gBACAc,GAAAC,QAAA,IAAA,WACAV,EAAAM,OAAA,QACAN,EAAAM,OAAAN,EAAAM,eAMAnH,KAAAwH,KAAA,WACAxH,KAAAkH,eACAlH,KAAAqH,mBCrOA,QAAA5C,cAAAgD,GAGA,GAAAC,IACAC,IAAAF,EAAAnD,KAAA,OACAhD,KAAAmG,EAAAnD,KAAA,SAGAsD,EAAA,SAAAtD,GACA,GAAAuD,KAQA,OANA7G,GAAA6B,KAAAyB,EAAA,SAAAwD,EAAAC,GACAA,IACAF,EAAAC,GAAAC,KAIA/G,EAAAgH,MAAAH,IAGAI,EAAA,SAAAC,EAAAC,GACA,GAAAlB,GAAApG,KAAAC,OAAAsH,OAAAjB,OAAAgB,EAAAhB,QAAA,GACAkB,EAAAxH,KAAAC,OAAAsH,OAAAE,MAAAH,EAAAG,OAAA,EAEAJ,GAAA5F,SAAAS,KAAAoF,EAAAR,IACAO,EAAAK,QACAL,EAAAM,SAAAL,EAAAG,MAAAH,EAAAhB,QAEAe,EAAAO,OAAAJ,EAAApB,IAUAyB,GACAC,cAAA,SAAAC,GACA,OACAjB,IAAA,iCAAAC,GACAiB,GAAAD,EAAAE,KACAnB,IAAAiB,EAAAjB,QAIAoB,SAAA,SAAAH,GACA,OACAjB,IAAA,6CAAAC,GACAoB,EAAAJ,EAAAjB,IACAsB,EAAAL,EAAAtH,OAEAgH,MAAA,IACAnB,OAAA,MAGA+B,QAAA,SAAAN,GACA,OACAjB,IAAA,oCAAAC,GACAtG,KAAAsH,EAAAtH,KACAqG,IAAAiB,EAAAjB,IACAwB,IAAAP,EAAAO,MAGAb,MAAA,IACAnB,OAAA,MAGAiC,SAAA,SAAAR,GACA,OACAjB,IAAA,0CAAAC,GACAD,IAAAiB,EAAAjB,IACA0B,SAAA,SAEAf,MAAA,IACAnB,OAAA,MAGAmC,UAAA,SAAAV,GACA,OACAjB,IAAA,+CAAAC,GACAD,IAAAiB,EAAAjB,IACAtC,YAAAuD,EAAAtH,KACAiI,MAAAX,EAAAnD,QAEA6C,MAAA,IACAnB,OAAA,OAMApH,EAAAC,IAEAA,MAAAwJ,aAAA,SAAAC,GACA,GAAAC,GAAA1I,EAAA,wCAAAyI,EAAA,oBAWA,OATAC,GAAA5H,KAAA6H,OAAA,YAEAD,EAAAzI,GAAA,QAAA,SAAAkD,GACAA,EAAAC,iBACArE,EAAA6J,MAAAH,KAGAhC,EAAArG,OAAAsI,GAEAA,GAGA1J,KAAA2E,cAAA,WACA8C,EAAArG,OAAArB,EAAAyJ,aAAA,YAIA,IAAAK,GAAA,SAAA3B,EAAAuB,EAAA9B,EAAAmC,GACA,GAAAC,GAAA/I,EAAAgJ,UAAAtC,EAEAqC,GAAAN,SAAAA,EAEAM,EAAAzI,OACAyI,EAAAzI,KAAAwI,EAAAnH,KAAA,QAAAC,OAAA,8BAAAI,KAAA,YAEA+G,EAAAZ,MACAY,EAAAZ,IAAAW,EAAAnH,KAAA,kBAAAK,KAAA,YAEA+G,EAAAjB,OACAiB,EAAAjB,KAAAgB,EAAAnH,KAAA,QAAAK,KAAA,SAEA+G,EAAAtE,QACAsE,EAAAtE,MAAAqE,EAAAnH,KAAA,QAAAC,OAAA,yBAAAI,KAAA,WAGA,IAAA1B,GAAAyI,EAAAzI,IAEA,IAAA,WAAAmI,EAAA,CACA,GAAAQ,GAAA,EAIA,IAHAF,EAAAZ,MACAc,IAAA,SAAAF,EAAAZ,KAAAhG,QAEA7B,EAAA6B,OAAA8G,EAAA,IAAA,CACA,GAAAC,GAAA5I,EAAA6B,OAAA8G,EAAA,GACA3I,GAAAA,EAAA6I,OAAA,EAAA7I,EAAA6B,OAAA+G,GAAA,KAIA,GAAAE,GAAA1B,EAAAe,IACA9B,IAAAA,EACArG,KAAAA,EACA6H,IAAAY,EAAAZ,KAGAlB,GAAAC,EAAAkC,GAGApK,MAAA4J,MAAA,SAAAH,GACA,GAAA9B,GAAAD,EAAAC,IAAAD,EAAAC,IAAAtH,OAAAiC,SAAAS,KAEAmF,EAAA7H,OAAAgK,KACA,GACA,QAAAZ,EACA,0DAGA,IAAApJ,OAAAiC,SAAAS,OAAA4E,EAAA,CAEA,GAAA2C,GAAAtJ,EAAA,gCACAkD,EAAAlD,EAAA,2GACAuJ,EAAAvJ,EAAA,wDACAuJ,GAAAzI,KAAA0I,SAAA,QAAAvD,IAAA,MAAAoB,KAAA,QACAnE,EAAA9C,OAAAmJ,GACAD,EAAAlJ,OAAA8C,GAEAlD,EAAA,QAAAI,OAAAkJ,GAEAtJ,EAAAyJ,KAAA9C,GACA+C,OAAA,EACAC,QAAA,SAAArG,GACAgG,EAAAM,SACAf,EAAA3B,EAAAuB,EAAA9B,EAAA3G,EAAA,WAAAI,OAAAkD,KAEAuG,MAAA,WACAP,EAAAM,SACAE,MAAA,uBAAAnD,UAIAkC,GAAA3B,EAAAuB,EAAA9B,EAAA3G,EAAAqB,YAKArC,KAAA0E,eAAA,WACA+C,EAAArG,OAAArB,EAAAyJ,aAAA,cAGAxJ,KAAA4E,aAAA,WACA6C,EAAArG,OAAArB,EAAAyJ,aAAA,iBAIAxJ,KAAA+K,eAAA,WACAtD,EAAArG,OAAArB,EAAAyJ,aAAA,YAIAxJ,KAAAgL,gBAAA,WACAvD,EAAArG,OAAArB,EAAAyJ,aAAA,eDnJA,GAAAyB,IA6KAjK,GAAA,WAEA,GAAAO,cAAAP,EAAA,cAAAA,EAAA,YAAAkB,SAAAD,gBAEA,GAAAE,sBAAAM,mBAAAzB,EAAA,UAEA,GAAAlB,YAAAiB,gBAEA,GAAAwC,aAAAC,gBAEA,GAAAD,aAAAG,gBAEA,GAAAH,aAAAK,sBAEA,GAAAL,aAAAgB,eAEA,GAAAhB,aAAAuC,gBAEA,GAAAvC,aAAAsB,qBAEA,GAAAtB,aAAA6C,yBAEA,GAAAQ,gBAAAY","file":"scripts.js","sourcesContent":["/*jslint browser: true, nomen: true */\n/*global $ */\n'use strict';\n\nfunction PageTimer() {\n  var self = this;\n  this.getLoadTime = function () {\n    var now = new Date().getTime();\n    // Get the performance object\n    window.performance = window.performance || window.mozPerformance || window.msPerformance || window.webkitPerformance || {};\n    var timing = performance.timing || {};\n\n    var ms = now - timing.navigationStart;\n\n    return Math.round(ms / 10) / 100;\n  };\n\n  this.logToConsole = function () {\n    $(window).on('load', function () {\n      console && console.info && console.info(\"Client loaded in \" + self.getLoadTime() + 's');\n    });\n  };\n\n  this.append = function (holder) {\n    $(window).on('load', function () {\n      holder.text(' | LT: ' + self.getLoadTime() + 's');\n    });\n  }\n}\n\n\nfunction StickyFooter($wrap, $footer) {\n  var $window = $(window);\n  this.updateWrapperCSS = function () {\n    var footerHeight = $footer.outerHeight();\n\n    $wrap.css({\n      marginBottom: -1 * footerHeight,\n      paddingBottom: footerHeight\n    });\n  };\n\n  this.bindOnResize = function () {\n    $window.on('resize', this.updateWrapperCSS);\n\n    return this;\n  };\n\n  this.update = function () {\n    this.updateWrapperCSS();\n\n    return this;\n  }\n}\n\n\n/*\n Ensure all external links load as new window/tabs:\n */\n\nvar App;\n\nfunction ExternalLinkHandler() {\n  var self = this;\n  var hostname = document.location.hostname;\n\n  this.matchInternalLink = [new RegExp(\"^https?:\\/\\/(.*?)\" + hostname)];\n\n  this.addTargetAttribute = function (context) {\n    context.find('a').filter('[href^=\"http://\"], [href^=\"https://\"]').each(function () {\n      var anchor = $(this);\n      var href = anchor.attr('href');\n      var isInternalLink = false;\n\n      for (var i = 0; i < self.matchInternalLink.length; i++) {\n        var regex = self.matchInternalLink[i];\n        if (href.match(regex)) {\n          isInternalLink = true;\n        }\n      }\n\n      if (!isInternalLink) {\n        anchor.attr('target', '_blank').addClass('external-link');\n      }\n    });\n  };\n\n}\n\nfunction UIBindings() {\n  this.bindTooltips = function () {\n    $('[data-toggle=\"tooltip\"]').tooltip();\n  };\n  this.bindPopovers = function () {\n    $('[data-toggle=\"popover\"]').popover();\n  };\n\n  this.bindSlickCarousels = function () {\n    $('[data-slick-carousel-default]').slick({\n      dots: true,\n      slidesToShow: 1,\n      slidesToScroll: 1,\n      arrows: true,\n      fade: true\n    });\n\n    $('[data-toggle=\"slick-nav\"]').on('click', function (e) {\n      e.preventDefault();\n      var index = $(this).data('index');\n      $('[data-slick-carousel-default]').slick('slickGoTo', index);\n    });\n  };\n\n  this.bindSharing = function () {\n    $(\"[data-share-default]\").each(function () {\n      var shareHandler = new ShareHandler($(this));\n      shareHandler.appendFacebook();\n      shareHandler.appendTwitter();\n      shareHandler.appendGoogle();\n      //shareHandler.appendLinkedIn();\n      //shareHandler.appendPinterest();\n    });\n  };\n\n  this.bindMagnificpopup = function(){\n    $('.gallery-image').magnificPopup({\n         type: 'image',\n         callbacks:\n          {\n              markupParse: function(template, values, item)\n                  {\n                      values.description = item.el.data('description');\n                  }\n          },\n          gallery:{\n            enabled:true\n          },\n\n          image:\n              {\n                  headerFit: true,\n                  captionFit: true,\n                  preserveHeaderAndCaptionWidth: false,\n                  markup:\n                  '<div class=\"mfp-figure\">'+\n                      '<figure>'+\n                          '<header class=\"mfp-header\">'+\n                              '<div class=\"mfp-top-bar\">'+\n                                  '<div class=\"mfp-title\"></div>'+\n                                  '<div class=\"mfp-close\"></div>'+\n                                  '<div class=\"mfp-decoration\"></div>'+\n                              '</div>'+\n                          '</header>'+\n                          '<section class=\"mfp-content-container\">'+\n                              '<div class=\"mfp-img\"></div>'+\n                          '</section>'+\n                          '<footer class=\"mfp-footer\">'+\n                              '<figcaption class=\"mfp-figcaption\">'+\n                                  '<div class=\"mfp-bottom-bar-container\">'+\n                                      '<div class=\"mfp-bottom-bar\">'+\n                                          '<div class=\"mfp-counter\"></div>'+\n                                          '<div class=\"mfp-description\"></div>'+\n                                          '<div class=\"mfp-decoration\"></div>'+\n                                      '</div>'+\n                                  '</div>'+\n                              '</figcaption>'+\n                          '</footer>'+\n                      '</figure>'+\n                  '</div>',\n              }\n    });\n  };\n\n  this.bindMasonary = function () {\n    $('img').load(function () {\n      $(\".grid\").masonry();\n    });\n    $('.grid').masonry({\n      itemSelector: '.grid-item',\n      columnWidth: '.grid-sizer',\n      gutter: 5,\n    });\n  }\n\n  this.bindSubmittingButtons = function () {\n    $(document).on('submit', function () {\n      var submitText = $(this).find('[data-submit-text]');\n      var submittingText = $(this).find('[data-submitting-text]');\n      var btn = submitText.closest('button');\n      submittingText.removeClass('hide');\n      submitText.hide();\n      btn.prop('disabled', true);\n    });\n  };\n\n\n}\n\nfunction Notifications () {\n  var wrapper = $('#notifications-wrapper');\n  var div = $('#notifications');\n  var wrapperTop = wrapper.offset().top;\n\n  this.bindOnScroll = function () {\n    wrapper.height(wrapper.height());\n    $(window).on('scroll', function () {\n      var scrollTop = $(window).scrollTop();\n      if (scrollTop > wrapperTop) {\n        div.addClass('fixed');\n      } else {\n        div.removeClass('fixed');\n      }\n    })\n  };\n\n  this.bindCloseButton = function () {\n    $(document).on('click', '[data-toggle=\"remove\"]', function (e) {\n      e.preventDefault();\n      var notification = $(this).closest('.notification');\n      notification.fadeOut(250, function () {\n        wrapper.height('auto');\n        wrapper.height(wrapper.height());\n\n      });\n    });\n  };\n\n  this.init = function () {\n    this.bindOnScroll();\n    this.bindCloseButton();\n  };\n}\n\n$(function () {\n\n  (new StickyFooter($('#container'), $('#footer'))).update().bindOnResize();\n\n  (new ExternalLinkHandler).addTargetAttribute($('body'));\n\n  (new PageTimer).logToConsole();\n\n  (new UIBindings).bindTooltips();\n\n  (new UIBindings).bindPopovers();\n\n  (new UIBindings).bindSlickCarousels();\n\n  (new UIBindings).bindSharing();\n\n  (new UIBindings).bindMasonary();\n\n  (new UIBindings).bindMagnificpopup();\n\n  (new UIBindings).bindSubmittingButtons();\n\n  (new Notifications).init();\n});\n","function ShareHandler($container) {\n  //var query = $.param(params);\n\n  var definedProps = {\n    url: $container.data('url'),\n    text: $container.data('text')\n  };\n\n  var buildHttpQuery = function (data) {\n    var copy = {};\n\n    $.each(data, function (k, v) {\n      if (v) {\n        copy[k] = v;\n      }\n    });\n\n    return $.param(copy);\n  };\n\n  var openPopup = function (shareWindow, conf) {\n    var top = Math.round((screen.height - conf.height)/2);\n    var left = Math.round((screen.width - conf.width)/2);\n\n    shareWindow.location.href = conf.url;\n    shareWindow.focus();\n    shareWindow.resizeTo(conf.width, conf.height);\n\n    shareWindow.moveTo(left, top);\n\n    //window.open(\n    //  conf.url,\n    //  \"share\" + conf.platform,\n    //  \"toolbar=0, status=0, width=\" + conf.width + \", height=\" + conf.height + \", top=\" + top + \", left=\" + left\n    //);\n\n  };\n\n  var popups = {\n    'google-plus': function (opt) {\n      return {\n        url: \"https://plus.google.com/share?\" + buildHttpQuery({\n          hl: opt.lang,\n          url: opt.url\n        })\n      };\n    },\n    facebook: function (opt) {\n      return {\n        url: \"http://www.facebook.com/sharer/sharer.php?\" + buildHttpQuery({\n          u: opt.url,\n          t: opt.text\n        }),\n        width: 900,\n        height: 500\n      };\n    },\n    twitter: function (opt) {\n      return {\n        url: \"https://twitter.com/intent/tweet?\" + buildHttpQuery({\n          text: opt.text,\n          url: opt.url,\n          via: opt.via\n        }),\n\n        width: 650,\n        height: 360\n      };\n    },\n    linkedin: function (opt) {\n      return {\n        url: 'https://www.linkedin.com/cws/share?url=' + buildHttpQuery({\n          url: opt.url,\n          isFramed: 'true'\n        }),\n        width: 550,\n        height: 550\n      };\n    },\n    pinterest: function (opt) {\n      return {\n        url: 'http://pinterest.com/pin/create/button/?url=' + buildHttpQuery({\n          url: opt.url,\n          description: opt.text,\n          media: opt.image\n        }),\n        width: 700,\n        height: 300\n      };\n    }\n  };\n\n\n  var self = this;\n\n  this.createButton = function (platform) {\n    var button = $('<a class=\"share-btn\"><i class=\"fa fa-' + platform + ' fa-lg\" ></i></a>');\n\n    button.css({cursor: 'pointer'});\n\n    button.on('click', function (e) {\n      e.preventDefault();\n      self.share(platform);\n    });\n\n    $container.append(button);\n\n    return button;\n  };\n\n  this.appendTwitter = function () {\n    $container.append(self.createButton('twitter'));\n  };\n\n\n  var sharePage = function (shareWindow, platform, url, $page) {\n    var shareProps = $.extend({}, definedProps);\n\n    shareProps.platform = platform;\n\n    if (!shareProps.text) {\n      shareProps.text = $page.find('meta').filter('[property=\"article-title\"]').attr('content');\n    }\n    if (!shareProps.via) {\n      shareProps.via = $page.find('#twitterHandle').attr('content');\n    }\n    if (!shareProps.lang) {\n      shareProps.lang = $page.find('html').attr('lang');\n    }\n    if (!shareProps.image) {\n      shareProps.image = $page.find('meta').filter('[property=\"og:image\"]').attr('content');\n    }\n\n    var text = shareProps.text;\n\n    if (platform == 'twitter') {\n      var startLen = 23 + 3; // twitter short URL length + 3\n      if (shareProps.via) {\n        startLen += (' via @' + shareProps.via).length;\n      }\n      if (text.length + startLen > 140) {\n        var diff = (text.length + startLen) - 140;\n        text = text.substr(0, text.length - diff) + '…';\n      }\n    }\n\n    var popupConf = popups[platform]({\n      url: url,\n      text: text,\n      via: shareProps.via\n    });\n\n    openPopup(shareWindow, popupConf);\n  };\n\n  this.share = function (platform) {\n    var url = definedProps.url ? definedProps.url : window.location.href;\n\n    var shareWindow = window.open(\n      \"\",\n      \"share\" + platform,\n      \"toolbar=0, status=0, width=\" + 50 + \", height=\" + 50 + \", top=\" + 0 + \", left=\" + 0\n    );\n\n    if (window.location.href !== url) {\n      // show loader\n      var shareLoader = $('<div id=\"shareLoader\"></div>');\n      var fade = $('<div style=\"position: fixed; left: 0; top: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5);\"></div>');\n      var spinner = $('<i class=\"fa fa-cog fa-spin\" style=\"color: #fff\"></i>');\n      spinner.css({position: 'fixed', top: '50%', left: '50%' });\n      fade.append(spinner);\n      shareLoader.append(fade);\n\n      $('body').append(shareLoader);\n\n      $.ajax(url, {\n        async:    true,\n        success: function (data) {\n          shareLoader.remove();\n          sharePage(shareWindow, platform, url, $('<root/>').append(data));\n        },\n        error: function () {\n          shareLoader.remove();\n          alert('Failed to load URL: ' + url);\n        }\n      });\n    } else {\n      sharePage(shareWindow, platform, url, $(document));\n    }\n\n  };\n\n  this.appendFacebook = function () {\n    $container.append(self.createButton('facebook'));\n  };\n\n  this.appendGoogle = function () {\n    $container.append(self.createButton('google-plus'));\n  };\n\n  // TODO test\n  this.appendLinkedIn = function () {\n    $container.append(self.createButton('linkin'));\n  };\n\n  // TODO test / enable\n  this.appendPinterest = function () {\n    $container.append(self.createButton('pinterest'));\n  };\n}\n"]}